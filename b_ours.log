nohup: ignoring input
/data/zikai/aaPFL/pfedlt/util/etf_methods.py:130: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  sparse_etf = torch.tensor(sparse_etf, requires_grad=True)
./temp/fl_acc_cifar10_resnet18_cons_frac0.2_iidFalse_iter500_ep5_lr0.03_N40_10_seed3407_p1_dirichlet0.5_IF0.01_LossCE.txt
Files already downloaded and verified
[5000, 2997, 1796, 1077, 645, 387, 232, 139, 83, 50]
12406
Files already downloaded and verified
Into non-iid sampling
clients_sizes:[215, 141, 207, 171, 243, 132, 178, 751, 618, 173, 602, 559, 821, 446, 221, 157, 127, 436, 273, 246, 171, 124, 90, 190, 252, 91, 656, 129, 194, 482, 1106, 528, 243, 102, 215, 267, 348, 153, 172, 176]
training set distribution:
[[ 72  83   9   1  40   5   5   0   0   0]
 [118   3   0   0   4   6   8   0   0   2]
 [ 32   5 132  20   4  13   0   0   0   1]
 [ 91  34  13   6  15   0   0  12   0   0]
 [ 73 128   1  12  13   5   7   1   1   2]
 [ 10  21  19  73   2   6   0   1   0   0]
 [  0  24 115  11   8   4  11   4   1   0]
 [105 484  11  91  36  11   0   0   6   7]
 [570   1  16   1   4  24   0   2   0   0]
 [  0 113  23   0  26   0  10   1   0   0]
 [397 138   7  22   4  21   0   0  12   1]
 [262 146  60   7  57   9  15   0   0   3]
 [581  84  98  20  17   6  12   1   0   2]
 [ 30   1 259 147   3   0   2   3   1   0]
 [ 15 145  33  11   3   2   0  11   1   0]
 [ 57   0  48  17  11   6   5  11   2   0]
 [  2  54   3   0  36  10  11   1   9   1]
 [323  53  41  10   8   0   0   0   1   0]
 [  2 250   8   2   0   2   2   0   4   3]
 [113  22  34   9  50   1   0  17   0   0]
 [ 93   4   3  29   1  31   5   3   2   0]
 [  0  66   0  40  10   0   1   6   0   1]
 [  0  28   6  36  10   1   3   0   4   2]
 [ 99   7  72   0   1   4   1   0   1   5]
 [126  52   6   0  46   2   8   1  11   0]
 [  3   1  59   6   6   0   4  10   1   1]
 [423 132   4  37  17  31   0  10   0   2]
 [  6   1  15  54  19  13  12   8   0   1]
 [  0 114   7   1   0  13  57   1   0   1]
 [428   0   5  21  13   1   1   0  12   1]
 [190 532 336  27   4  10   0   3   2   2]
 [332 110  13  53   0   4  11   1   4   0]
 [152  27  10   4  22   7   5  11   0   5]
 [  2  11  44  31   3   0   3   6   1   1]
 [ 62  79   7  26   0  40   1   0   0   0]
 [  1   1   2 179  43  30  11   0   0   0]
 [125  11 107  11  30  54   2   8   0   0]
 [ 20  14  87   3  14   0   8   2   5   0]
 [ 48  18  32  29  31   6   0   1   1   6]
 [ 37   0  51  30  34   9  11   3   1   0]]
Total size of training set
12406
local test distribution:
[[ 58  66   7   0  32   4   4   0   0   0]
 [ 95   2   0   0   3   4   6   0   0   1]
 [ 25   4 106  16   3  10   0   0   0   0]
 [ 73  27  10   4  12   0   0   9   0   0]
 [ 58 103   0   9  10   4   5   0   0   1]
 [  8  16  15  58   1   4   0   0   0   0]
 [  0  19  92   8   6   3   8   3   0   0]
 [ 84 390   8  73  29   8   0   0   4   5]
 [459   0  12   0   3  19   0   1   0   0]
 [  0  91  18   0  20   0   8   0   0   0]
 [320 111   5  17   3  16   0   0   9   0]
 [211 117  48   5  45   7  12   0   0   2]
 [468  67  78  16  13   4   9   0   0   1]
 [ 24   0 208 118   2   0   1   2   0   0]
 [ 12 116  26   8   2   1   0   8   0   0]
 [ 45   0  38  13   8   4   4   8   1   0]
 [  1  43   2   0  29   8   8   0   7   0]
 [260  42  33   8   6   0   0   0   0   0]
 [  1 201   6   1   0   1   1   0   3   2]
 [ 91  17  27   7  40   0   0  13   0   0]
 [ 74   3   2  23   0  24   4   2   1   0]
 [  0  53   0  32   8   0   0   4   0   0]
 [  0  22   4  29   8   0   2   0   3   1]
 [ 79   5  58   0   0   3   0   0   0   4]
 [101  41   4   0  37   1   6   0   8   0]
 [  2   0  47   4   4   0   3   8   0   0]
 [340 106   3  29  13  24   0   8   0   1]
 [  4   0  12  43  15  10   9   6   0   0]
 [  0  91   5   0   0  10  45   0   0   0]
 [344   0   4  16  10   0   0   0   9   0]
 [153 428 270  21   3   8   0   2   1   1]
 [267  88  10  42   0   3   8   0   3   0]
 [122  21   8   3  17   5   4   8   0   4]
 [  1   8  35  24   2   0   2   4   0   0]
 [ 49  63   5  20   0  32   0   0   0   0]
 [  0   0   1 144  34  24   8   0   0   0]
 [100   8  86   8  24  43   1   6   0   0]
 [ 16  11  70   2  11   0   6   1   4   0]
 [ 38  14  25  23  24   4   0   0   0   4]
 [ 29   0  41  24  27   7   8   2   0   0]]
Total size of testing set
9829
[4012 2394 1429  848  504  295  172   95   53   27]
40
Step 0, Loss 1.2786084413528442
Step 100, Loss 0.2238391637802124
Step 200, Loss -0.46556174755096436
Step 300, Loss -0.9142656922340393
Step 400, Loss -1.203202247619629
Step 500, Loss -1.3874839544296265
Step 600, Loss -1.5035239458084106
Step 700, Loss -1.5765867233276367
Step 800, Loss -1.621006727218628
Step 900, Loss -1.647348403930664
Step 1000, Loss -1.6622207164764404
Step 1100, Loss -1.6705503463745117
Step 1200, Loss -1.6746091842651367
Step 1300, Loss -1.6775033473968506
Step 1400, Loss -1.6787492036819458
Step 1500, Loss -1.679220199584961
Step 1600, Loss -1.679751992225647
Step 1700, Loss -1.6800918579101562
Step 1800, Loss -1.6801832914352417
Step 1900, Loss -1.6799860000610352
Step 2000, Loss -1.6802524328231812
Step 2100, Loss -1.6801005601882935
Step 2200, Loss -1.680379867553711
Step 2300, Loss -1.6796640157699585
Step 2400, Loss -1.6806344985961914
Step 2500, Loss -1.6800806522369385
Step 2600, Loss -1.6805005073547363
Step 2700, Loss -1.680245280265808
Step 2800, Loss -1.6802819967269897
Step 2900, Loss -1.6799699068069458
Step 3000, Loss -1.6806120872497559
Step 3100, Loss -1.6803888082504272
Step 3200, Loss -1.680387020111084
Step 3300, Loss -1.6804478168487549
Step 3400, Loss -1.6804683208465576
Step 3500, Loss -1.6804001331329346
Step 3600, Loss -1.680649757385254
Step 3700, Loss -1.6807612180709839
Step 3800, Loss -1.6804527044296265
Step 3900, Loss -1.6806565523147583
Step 4000, Loss -1.6805329322814941
Step 4100, Loss -1.680406093597412
Step 4200, Loss -1.6805801391601562
Step 4300, Loss -1.680472731590271
Step 4400, Loss -1.6805533170700073
Step 4500, Loss -1.6802054643630981
Step 4600, Loss -1.680498480796814
Step 4700, Loss -1.6809632778167725
Step 4800, Loss -1.6806552410125732
Step 4900, Loss -1.6803749799728394
Step 5000, Loss -1.6804993152618408
Step 5100, Loss -1.6805917024612427
Step 5200, Loss -1.6808115243911743
Step 5300, Loss -1.6803611516952515
Step 5400, Loss -1.6807653903961182
Step 5500, Loss -1.680922269821167
Step 5600, Loss -1.68047034740448
Step 5700, Loss -1.6807835102081299
Step 5800, Loss -1.6804940700531006
Step 5900, Loss -1.6804896593093872
Step 6000, Loss -1.6804298162460327
Step 6100, Loss -1.6805981397628784
Step 6200, Loss -1.6802440881729126
Step 6300, Loss -1.6805356740951538
Step 6400, Loss -1.6804918050765991
Step 6500, Loss -1.6806265115737915
Step 6600, Loss -1.6807795763015747
Step 6700, Loss -1.680687427520752
Step 6800, Loss -1.6803349256515503
Step 6900, Loss -1.6807653903961182
Step 7000, Loss -1.6805070638656616
Step 7100, Loss -1.6804001331329346
Step 7200, Loss -1.6808873414993286
Step 7300, Loss -1.6803605556488037
Step 7400, Loss -1.6807894706726074
Step 7500, Loss -1.6803936958312988
Step 7600, Loss -1.6806623935699463
Step 7700, Loss -1.680078387260437
Step 7800, Loss -1.680751085281372
Step 7900, Loss -1.6804512739181519
Step 8000, Loss -1.680332899093628
Step 8100, Loss -1.6808768510818481
Step 8200, Loss -1.6805534362792969
Step 8300, Loss -1.6808595657348633
Step 8400, Loss -1.6805952787399292
Step 8500, Loss -1.6807447671890259
Step 8600, Loss -1.6807432174682617
Step 8700, Loss -1.6804428100585938
Step 8800, Loss -1.6805084943771362
Step 8900, Loss -1.6808000802993774
Step 9000, Loss -1.6806161403656006
Step 9100, Loss -1.6806246042251587
Step 9200, Loss -1.680752158164978
Step 9300, Loss -1.68075430393219
Step 9400, Loss -1.6808598041534424
Step 9500, Loss -1.6806373596191406
Step 9600, Loss -1.6806073188781738
Step 9700, Loss -1.680408239364624
Step 9800, Loss -1.6806243658065796
Step 9900, Loss -1.680938720703125
Angle Mean: 96.37914276123047, Angle Variance: 0.004037953447550535
Norm Mean: 0.10058677196502686, Norm Variance: 4.347456172837383e-09
  0%|          | 0/500 [00:00<?, ?it/s]  0%|          | 1/500 [02:03<17:03:01, 123.01s/it]  0%|          | 2/500 [03:55<16:08:47, 116.72s/it]3shot of client 0:head:0.3717948717948718, middle:0.0, tail0.0
3shot of client 1:head:1.0, middle:0.0, tail0.0
3shot of client 2:head:0.8091603053435115, middle:0.0, tail0.0
3shot of client 3:head:0.6517857142857143, middle:0.0, tail0.0
3shot of client 4:head:0.36024844720496896, middle:0.0, tail0.0
3shot of client 5:head:0.1797752808988764, middle:0.0, tail0.0
3shot of client 6:head:0.6756756756756757, middle:0.045454545454545456, tail0.0
3shot of client 7:head:0.8227848101265823, middle:0.0, tail0.0
3shot of client 8:head:1.0, middle:0.0, tail0.0
3shot of client 9:head:0.18018018018018017, middle:0.0, tail0
3shot of client 10:head:0.7470997679814385, middle:0.0, tail0.0
3shot of client 11:head:0.5664893617021277, middle:0.0, tail0.0
3shot of client 12:head:0.8571428571428571, middle:0.0, tail0.0
3shot of client 13:head:0.6380368098159509, middle:0.0, tail0.0
3shot of client 14:head:0.8591549295774648, middle:0.0, tail0.0
3shot of client 15:head:0.46875, middle:0.0, tail0.0
3shot of client 16:head:0.3625, middle:0.0, tail0.0
3shot of client 17:head:0.8642384105960265, middle:0.0, tail0.0
3shot of client 18:head:1.0, middle:0.0, tail0.0
3shot of client 19:head:0.45569620253164556, middle:0.0, tail0.0
3shot of client 20:head:0.6115702479338843, middle:0.0, tail0.0
3shot of client 21:head:0.6235294117647059, middle:0.0, tail0.0
3shot of client 22:head:0.13559322033898305, middle:0.0, tail0.0
3shot of client 23:head:0.5766423357664233, middle:0.0, tail0.0
3shot of client 24:head:0.5698324022346368, middle:0.0, tail0.0
3shot of client 25:head:0.8545454545454545, middle:0.0, tail0.0
3shot of client 26:head:0.7623318385650224, middle:0.0, tail0.0
3shot of client 27:head:0.5375, middle:0.0, tail0.0
3shot of client 28:head:0.6544117647058824, middle:0.0, tail0.0
3shot of client 29:head:1.0, middle:0.0, tail0.0
3shot of client 30:head:0.0, middle:1.0, tail0.0
3shot of client 31:head:0.752112676056338, middle:0.0, tail0.0
3shot of client 32:head:0.7625, middle:0.0, tail0.0
3shot of client 33:head:0.2711864406779661, middle:0.0, tail0.0
3shot of client 34:head:0.0, middle:1.0, tail0.0
3shot of client 35:head:0.8089887640449438, middle:0.0, tail0.0
3shot of client 36:head:0.37554585152838427, middle:0.0, tail0.0
3shot of client 37:head:0.0, middle:0.5238095238095238, tail0.0
3shot of client 38:head:0.21818181818181817, middle:0.0, tail0.0
3shot of client 39:head:0.2231404958677686, middle:0.0, tail0.0
round 0, local average test acc  0.4935 

round 0, local macro average F1 score  0.1013 

round 0, local weighted average F1 score  0.3746 

round 0, global test acc  0.1000 

round 0, average 3shot acc: [head: 0.5652, middle: 0.0642, tail: 0.0000] 

round 0, global 3shot acc: [head: 0.0000, middle: 0.3333, tail: 0.0000] 

l_head tensor([1.0184, 1.0045, 0.7056, 0.6131, 0.8304, 0.6320, 0.6423, 0.6208, 0.6300,
        0.6171], device='cuda:0', grad_fn=<LinalgVectorNormBackward0>)
g_aux tensor([0.6188, 0.5985, 0.5971, 0.5939, 0.5952, 0.5701, 0.5739, 0.5959, 0.6083,
        0.5866], device='cuda:0', grad_fn=<LinalgVectorNormBackward0>)
3shot of client 0:head:0.5576923076923077, middle:0.0, tail0.0
3shot of client 1:head:1.0, middle:0.0, tail0.0
3shot of client 2:head:0.8396946564885496, middle:0.0, tail0.0
3shot of client 3:head:0.5089285714285714, middle:0.0, tail0.0
3shot of client 4:head:0.4409937888198758, middle:0.0, tail0.0
3shot of client 5:head:0.6067415730337079, middle:0.625, tail0.0
3shot of client 6:head:0.6486486486486487, middle:0.045454545454545456, tail0.0
3shot of client 7:head:0.4240506329113924, middle:0.5490196078431373, tail0.0
3shot of client 8:head:1.0, middle:0.0, tail0.0
3shot of client 9:head:0.27927927927927926, middle:0.6923076923076923, tail0
3shot of client 10:head:0.7563805104408353, middle:0.0, tail0.0
3shot of client 11:head:0.574468085106383, middle:0.0, tail0.0
3shot of client 12:head:0.8937728937728938, middle:0.012048192771084338, tail0.0
3shot of client 13:head:0.5766871165644172, middle:0.4583333333333333, tail0.0
3shot of client 14:head:0.5140845070422535, middle:0.5, tail0.0
3shot of client 15:head:0.46875, middle:0.0, tail0.0
3shot of client 16:head:0.625, middle:0.0, tail0.0
3shot of client 17:head:0.8609271523178808, middle:0.0, tail0.0
3shot of client 18:head:0.9303482587064676, middle:0.3333333333333333, tail0.0
3shot of client 19:head:0.6329113924050633, middle:0.0, tail0.0
3shot of client 20:head:0.6115702479338843, middle:0.0, tail0.0
3shot of client 21:head:0.4117647058823529, middle:0.0, tail0.0
3shot of client 22:head:0.559322033898305, middle:0.0, tail0.0
3shot of client 23:head:0.7883211678832117, middle:0.0, tail0.0
3shot of client 24:head:0.659217877094972, middle:0.0, tail0.0
3shot of client 25:head:0.7818181818181819, middle:0.0, tail0.5
3shot of client 26:head:0.7892376681614349, middle:0.05660377358490566, tail0.0
3shot of client 27:head:0.5375, middle:0.0, tail0.0
3shot of client 28:head:0.5735294117647058, middle:0.5, tail0.0
3shot of client 29:head:1.0, middle:0.0, tail0.0
3shot of client 30:head:0.2621776504297994, middle:0.9215686274509803, tail0.0
3shot of client 31:head:0.7323943661971831, middle:0.21153846153846154, tail0.0
3shot of client 32:head:0.7625, middle:0.0, tail0.0
3shot of client 33:head:0.5932203389830508, middle:0.07142857142857142, tail0.0
3shot of client 34:head:0.3888888888888889, middle:0.0, tail0.0
3shot of client 35:head:0.8089887640449438, middle:0.0, tail0.0
3shot of client 36:head:0.6419213973799127, middle:0.05, tail0.0
3shot of client 37:head:0.0, middle:0.5238095238095238, tail0.0
3shot of client 38:head:0.44545454545454544, middle:0.05555555555555555, tail0.0
3shot of client 39:head:0.24793388429752067, middle:0.0, tail0.0
round 1, local average test acc  0.5479 

round 1, local macro average F1 score  0.1564 

round 1, local weighted average F1 score  0.4563 

round 1, global test acc  0.1313 

round 1, average 3shot acc: [head: 0.6184, middle: 0.1402, tail: 0.0128] 

round 1, global 3shot acc: [head: 0.4317, middle: 0.0057, tail: 0.0002] 

l_head tensor([1.1826, 1.4189, 0.8065, 0.6756, 1.1873, 0.6946, 0.7219, 0.6460, 0.6543,
        0.6406], device='cuda:0', grad_fn=<LinalgVectorNormBackward0>)
g_aux tensor([0.7370, 0.6814, 0.6572, 0.6308, 0.6429, 0.5810, 0.5976, 0.5968, 0.6153,
        0.5942], device='cuda:0', grad_fn=<LinalgVectorNormBackward0>)
3shot of client 0:head:0.5641025641025641, middle:0.0, tail0.0
3shot of client 1:head:1.0, middle:0.0, tail0.0
3shot of client 2:head:0.8244274809160306, middle:0.038461538461538464, tail0.0
3shot of client 3:head:0.5267857142857143, middle:0.0, tail0.5
3shot of client 4:head:0.4472049689440994, middle:0.2916666666666667, tail0.0
3shot of client 5:head:0.30337078651685395, middle:0.75, tail0.0
3shot of client 6:head:0.6576576576576577, middle:0.0, tail0.0
3shot of client 7:head:0.5928270042194093, middle:0.47058823529411764, tail0.0
3shot of client 8:head:1.0, middle:0.0, tail0.0
3shot of client 9:head:0.6486486486486487, middle:0.6538461538461539, tail0
3shot of client 10:head:0.7703016241299304, middle:0.0, tail0.0
3shot of client 11:head:0.5691489361702128, middle:0.0, tail0.0
3shot of client 12:head:0.8864468864468864, middle:0.12048192771084337, tail0.0
3shot of client 13:head:0.647239263803681, middle:0.16666666666666666, tail0.0
3shot of client 14:head:0.34507042253521125, middle:0.6071428571428571, tail0.0
3shot of client 15:head:0.3958333333333333, middle:0.0, tail0.0
3shot of client 16:head:0.5, middle:0.0, tail0.0
3shot of client 17:head:0.7582781456953642, middle:0.7878787878787878, tail0.0
3shot of client 18:head:0.8407960199004975, middle:0.5, tail0.0
3shot of client 19:head:0.6329113924050633, middle:0.03333333333333333, tail0.0
3shot of client 20:head:0.6528925619834711, middle:0.14285714285714285, tail0.0
3shot of client 21:head:0.6352941176470588, middle:0.0, tail0.25
3shot of client 22:head:0.3220338983050847, middle:0.2857142857142857, tail0.0
3shot of client 23:head:0.8613138686131386, middle:0.0, tail0.0
3shot of client 24:head:0.6983240223463687, middle:0.0, tail0.0
3shot of client 25:head:0.8181818181818182, middle:0.0, tail0.5
3shot of client 26:head:0.7937219730941704, middle:0.0, tail0.0
  1%|          | 3/500 [05:38<15:15:29, 110.52s/it]